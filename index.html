<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Flor amarilla • Galaxia viva</title>
<meta name="description" content="Un detalle romántico: una flor amarilla elegante sobre una galaxia animada."/>
<style>
  :root{
    /* Paleta y parámetros */
    --txt:#F7F7F5;
    --bg:#05060F;

    /* Flor */
    --petal-light:#FFE589;
    --petal-mid:#F6C549;
    --petal-deep:#E7B137;
    --edge-gold:#EED28A;
    --center-1:#FFD76A;
    --center-2:#DAA520;
    --center-3:#A87600;
    --leaf:#3FA263;
    --leaf-dark:#2C7D4A;
    --stem:#2F7B32;
    --halo:#EACB76;

    /* Duraciones/curvas */
    --fast:220ms; --med:480ms; --slow:900ms;
    --ease: cubic-bezier(.215,.61,.355,1);

    /* Layout */
    --maxw: 980px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--txt); background:var(--bg);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans";
    overflow:hidden; /* el lienzo ocupa todo */
  }

  /* Fondo galaxia */
  #sky{
    position:fixed; inset:0; z-index:-4; display:block;
    background: radial-gradient(1200px 800px at 70% 30%, rgba(90,0,110,.25), transparent 60%),
                radial-gradient(900px 600px  at 30% 70%, rgba(0,70,140,.20), transparent 60%),
                linear-gradient(180deg, #05060D 0%, #0B0E1F 100%);
  }
  /* Nebulosas extra (suave, sobre el canvas) */
  .nebula{
    position:fixed; inset:-8%; z-index:-3; mix-blend-mode:screen; pointer-events:none;
    filter: blur(18px) saturate(115%);
  }
  .nebula.a{
    background:
      radial-gradient(45% 35% at 65% 40%, rgba(140,70,210,.45), transparent 65%),
      radial-gradient(38% 30% at 30% 65%, rgba(255,180,120,.38), transparent 65%);
    animation: spinA 160s linear infinite;
  }
  .nebula.b{
    background:
      radial-gradient(42% 32% at 70% 60%, rgba(80,160,255,.32), transparent 65%),
      radial-gradient(34% 28% at 40% 40%, rgba(255,240,160,.22), transparent 65%);
    animation: spinB 220s linear infinite reverse;
  }
  @keyframes spinA {to{transform:rotate(360deg) scale(1.03)}}
  @keyframes spinB {to{transform:rotate(360deg) scale(1.04)}}

  /* Layout principal */
  main{
    position:relative; z-index:1;
    min-height:100dvh; display:grid; place-items:center;
    padding:4rem 1rem 5rem; max-width:var(--maxw); margin:0 auto; text-align:center;
  }

  .ghost-btn{
    position:fixed; top:1rem; right:1rem; z-index:2;
    background: rgba(20,22,40,.28); color:var(--txt);
    border:1px solid rgba(255,255,255,.25); border-radius:999px;
    padding:.6rem 1rem; backdrop-filter: blur(6px) saturate(120%);
    cursor:pointer;
    transition: transform var(--fast) var(--ease), border-color var(--fast) var(--ease);
  }
  .ghost-btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.45); }
  .ghost-btn:focus-visible{ outline:2px solid var(--halo); outline-offset:3px; }

  /* Flor */
  .flower{
    margin:0; display:inline-block;
    filter: drop-shadow(0 12px 26px rgba(0,0,0,.45));
    transform-origin:50% 100%;
    animation: sway 7s var(--ease) infinite alternate;
    will-change: transform, filter;
  }
  @keyframes sway{
    0%{transform:rotate(-1.1deg) translateY(0)}
    100%{transform:rotate(1.1deg) translateY(-1px)}
  }
  .flower-svg{display:block}

  /* Mensaje */
  .message{
    margin-top:1.2rem; max-width:min(92vw, 720px);
    background: rgba(10,12,22,.55);
    border:1px solid rgba(255,255,255,.16);
    border-radius:16px; padding:1rem 1.25rem;
    backdrop-filter: blur(10px) saturate(120%);
    box-shadow:0 10px 24px rgba(0,0,0,.28);
    transition: opacity var(--med) var(--ease), transform var(--med) var(--ease);
  }
  .message[hidden]{display:block; opacity:0; transform:translateY(6px) scale(.985); height:0; padding:0 1.25rem; border-color:transparent; overflow:hidden}
  .message p{margin:0; line-height:1.7; letter-spacing:.15px}

  /* Accesibilidad útil */
  .visually-hidden{
    position:absolute !important; height:1px; width:1px; overflow:hidden;
    clip:rect(1px,1px,1px,1px); white-space:nowrap; border:0; padding:0; margin:-1px;
  }

  /* SVG estilado (reutilizable) */
  .stem{ fill:none; stroke:var(--stem); stroke-width:6; stroke-linecap:round;
         filter: drop-shadow(0 1px 2px rgba(0,0,0,.35)); }
  .leaf{ fill:var(--leaf); filter: drop-shadow(0 2px 2px rgba(0,0,0,.25)); }
  .leaf.veins{ fill:none; stroke:rgba(255,255,255,.15); stroke-width:1; }

  .petal{
    fill:url(#petalGrad);
    stroke:rgba(160,120,40,.28); stroke-width:.7; paint-order: stroke fill;
    filter: drop-shadow(0 .5px 0 rgba(255,255,255,.12)) drop-shadow(0 2px 4px rgba(0,0,0,.25));
    transform-origin:180px 230px;
    transition: transform var(--med) var(--ease), filter var(--med) var(--ease);
  }
  .petal.front{ filter: drop-shadow(0 0 .6px rgba(255,255,255,.18)) drop-shadow(0 3px 6px rgba(0,0,0,.3)); }

  .center{ filter: drop-shadow(0 0 3px rgba(0,0,0,.25)) drop-shadow(0 0 12px rgba(255,210,90,.18));
           transition: filter var(--fast) var(--ease); }
  .halo{ transition: opacity var(--fast) var(--ease); }

  /* Hover/focus: micro-bloom */
  .flower:hover .petal, .flower:focus-visible .petal{ transform:scale(1.035); }
  .flower:hover .center, .flower:focus-visible .center{
    filter: drop-shadow(0 0 10px rgba(255,220,120,.45)) drop-shadow(0 0 26px rgba(255,220,120,.28));
  }
  .flower:hover .halo, .flower:focus-visible .halo{ opacity:.95 }

  /* Click: florecer */
  .flower.bloom .petal{ transform:scale(1.06) }

  /* Reduce motion */
  @media (prefers-reduced-motion: reduce){
    #sky{background-attachment:initial}
    .nebula, .flower{animation:none !important}
  }
</style>
</head>
<body>
<canvas id="sky" aria-hidden="true"></canvas>
<div class="nebula a" aria-hidden="true"></div>
<div class="nebula b" aria-hidden="true"></div>

<main>
  <button id="toggleMessage" class="ghost-btn" type="button"
          aria-controls="loveMessage" aria-expanded="false">Mostrar mensaje</button>

  <!-- FLOR SVG DE ALTA CALIDAD -->
  <figure class="flower" aria-label="Flor amarilla elegante" role="img" tabindex="0">
    <svg class="flower-svg" viewBox="0 0 360 520" width="360" height="520" aria-hidden="true">
      <defs>
        <!-- Gradiente pétalos -->
        <radialGradient id="petalGrad" cx="50%" cy="40%" r="70%">
          <stop offset="0%"   stop-color="var(--petal-light)"/>
          <stop offset="55%"  stop-color="var(--petal-mid)"/>
          <stop offset="100%" stop-color="var(--petal-deep)"/>
        </radialGradient>

        <!-- Centro -->
        <radialGradient id="centerGrad" cx="50%" cy="50%" r="60%">
          <stop offset="0%"   stop-color="var(--center-1)"/>
          <stop offset="55%"  stop-color="var(--center-2)"/>
          <stop offset="100%" stop-color="var(--center-3)"/>
        </radialGradient>

        <!-- Halo dorado del centro -->
        <radialGradient id="haloGrad" cx="50%" cy="50%" r="100%">
          <stop offset="0%"   stop-color="rgba(255,214,120,0.55)"/>
          <stop offset="60%"  stop-color="rgba(255,214,120,0.18)"/>
          <stop offset="100%" stop-color="rgba(255,214,120,0)"/>
        </radialGradient>

        <!-- Semillas textura -->
        <pattern id="seeds" patternUnits="userSpaceOnUse" width="6" height="6">
          <circle cx="2" cy="2" r="0.7" fill="rgba(255,240,200,0.6)"/>
          <circle cx="4" cy="4" r="0.6" fill="rgba(210,150,60,0.35)"/>
        </pattern>

        <!-- Sombras suaves -->
        <filter id="softShadow" x="-50%" y="-50%" width="200%" height="200%">
          <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="rgba(0,0,0,0.35)"/>
        </filter>

        <!-- Petalo base (curva orgánica) -->
        <path id="petalPath" d="M180 228
           C 150 198, 150 166, 180 156
           C 210 166, 210 198, 180 228 Z" />
        <!-- Pétalo exterior algo más largo -->
        <path id="petalPathLong" d="M180 232
           C 146 188, 146 152, 180 140
           C 214 152, 214 188, 180 232 Z" />
      </defs>

      <!-- Sombra bajo la flor -->
      <ellipse cx="180" cy="495" rx="70" ry="14" fill="rgba(0,0,0,.35)" filter="url(#softShadow)"></ellipse>

      <!-- Tallo -->
      <path class="stem" d="M180 300 C176 360, 184 420, 180 480"/>

      <!-- Hojas -->
      <g filter="url(#softShadow)">
        <path class="leaf" d="M175 360 C130 345, 110 320, 122 300 C138 278, 160 288, 175 315 Z"/>
        <path class="leaf veins" d="M162 332 C150 324, 138 318, 128 316"/>
        <path class="leaf" d="M185 385 C235 370, 255 345, 243 325 C227 305, 205 315, 185 340 Z"/>
        <path class="leaf veins" d="M198 356 C212 348, 226 342, 236 340"/>
      </g>

      <!-- Halo del centro -->
      <circle class="halo" cx="180" cy="230" r="46" fill="url(#haloGrad)" opacity=".8"/>

      <!-- CORONA EXTERIOR (12 pétalos largos) -->
      <g>
        <!-- 12 rotaciones, gradiente + leve variación angular -->
        <g transform="rotate(0 180 230)"><use href="#petalPathLong" class="petal"/></g>
        <g transform="rotate(30 180 230)"><use href="#petalPathLong" class="petal"/></g>
        <g transform="rotate(60 180 230)"><use href="#petalPathLong" class="petal"/></g>
        <g transform="rotate(90 180 230)"><use href="#petalPathLong" class="petal"/></g>
        <g transform="rotate(120 180 230)"><use href="#petalPathLong" class="petal"/></g>
        <g transform="rotate(150 180 230)"><use href="#petalPathLong" class="petal"/></g>
        <g transform="rotate(180 180 230)"><use href="#petalPathLong" class="petal"/></g>
        <g transform="rotate(210 180 230)"><use href="#petalPathLong" class="petal"/></g>
        <g transform="rotate(240 180 230)"><use href="#petalPathLong" class="petal"/></g>
        <g transform="rotate(270 180 230)"><use href="#petalPathLong" class="petal"/></g>
        <g transform="rotate(300 180 230)"><use href="#petalPathLong" class="petal"/></g>
        <g transform="rotate(330 180 230)"><use href="#petalPathLong" class="petal"/></g>
      </g>

      <!-- CORONA MEDIA (10 pétalos) -->
      <g>
        <g transform="rotate(18 180 230)"><use href="#petalPath" class="petal"/></g>
        <g transform="rotate(54 180 230)"><use href="#petalPath" class="petal"/></g>
        <g transform="rotate(90 180 230)"><use href="#petalPath" class="petal"/></g>
        <g transform="rotate(126 180 230)"><use href="#petalPath" class="petal"/></g>
        <g transform="rotate(162 180 230)"><use href="#petalPath" class="petal"/></g>
        <g transform="rotate(198 180 230)"><use href="#petalPath" class="petal"/></g>
        <g transform="rotate(234 180 230)"><use href="#petalPath" class="petal"/></g>
        <g transform="rotate(270 180 230)"><use href="#petalPath" class="petal"/></g>
        <g transform="rotate(306 180 230)"><use href="#petalPath" class="petal"/></g>
        <g transform="rotate(342 180 230)"><use href="#petalPath" class="petal"/></g>
      </g>

      <!-- CORONA INTERIOR (8 pétalos más cortos) -->
      <g>
        <g transform="rotate(0 180 230) scale(.9 .9) translate(18 23)"><use href="#petalPath" class="petal front"/></g>
        <g transform="rotate(45 180 230) scale(.9 .9) translate(18 23)"><use href="#petalPath" class="petal front"/></g>
        <g transform="rotate(90 180 230) scale(.9 .9) translate(18 23)"><use href="#petalPath" class="petal front"/></g>
        <g transform="rotate(135 180 230) scale(.9 .9) translate(18 23)"><use href="#petalPath" class="petal front"/></g>
        <g transform="rotate(180 180 230) scale(.9 .9) translate(18 23)"><use href="#petalPath" class="petal front"/></g>
        <g transform="rotate(225 180 230) scale(.9 .9) translate(18 23)"><use href="#petalPath" class="petal front"/></g>
        <g transform="rotate(270 180 230) scale(.9 .9) translate(18 23)"><use href="#petalPath" class="petal front"/></g>
        <g transform="rotate(315 180 230) scale(.9 .9) translate(18 23)"><use href="#petalPath" class="petal front"/></g>
      </g>

      <!-- Centro -->
      <circle class="center" cx="180" cy="230" r="24" fill="url(#centerGrad)"/>
      <circle class="center" cx="180" cy="230" r="19" fill="url(#seeds)"/>
    </svg>
    <figcaption class="visually-hidden">Flor amarilla realista, elegante, sobre un fondo de galaxia animada.</figcaption>
  </figure>

  <!-- Mensaje romántico -->
  <section id="loveMessage" class="message" hidden>
    <p id="typewriter"></p>
  </section>
</main>

<script>
/* =================== CONFIG =================== */
const CONFIG = {
  mensaje: "En el cielo inmenso, tú eres mi flor favorita.",
  escribirVelocidadMs: 22,
  parallax: true,
  parallaxNear: 0.018,
  parallaxFar:  0.007,
  starsNear: 220,
  starsFar:  160,
  meteors: true,
  meteorEveryMs: [4500, 9000] // min, max
};
const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;

/* =================== GALAXIA (canvas) =================== */
const cvs = document.getElementById('sky');
const ctx = cvs.getContext('2d');
let DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
let W=0, H=0;

function resize(){
  DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  W = Math.floor(innerWidth * DPR);
  H = Math.floor(innerHeight * DPR);
  cvs.width = W; cvs.height = H;
  cvs.style.width = innerWidth + 'px';
  cvs.style.height = innerHeight + 'px';
}
resize(); addEventListener('resize', resize);

function rand(a,b){return Math.random()*(b-a)+a}
function clamp(n,a,b){return Math.max(a,Math.min(b,n))}

class Star{
  constructor(layer){
    this.layer = layer; // near/far
    this.reset(true);
  }
  reset(first=false){
    this.x = rand(0,W);
    this.y = rand(0,H);
    this.r = (this.layer==='near'? rand(0.8,1.8): rand(0.5,1.2)) * DPR;
    this.baseAlpha = this.layer==='near'? rand(0.5,0.9) : rand(0.35,0.7);
    this.alpha = this.baseAlpha;
    this.tw = rand(1.2,2.6) * (this.layer==='near'? 1: 1.2);
    this.phase = rand(0,Math.PI*2);
    this.vx = (this.layer==='near'? 0.012: -0.008) * DPR; // deriva lenta
    this.vy = (this.layer==='near'? -0.006: 0.004) * DPR;
    if(first){
      this.x = rand(0,W); this.y = rand(0,H);
    }
  }
  step(t,px=0,py=0){
    // twinkle
    this.alpha = this.baseAlpha + Math.sin(t*this.tw + this.phase)*0.15;
    this.alpha = clamp(this.alpha, 0.15, 1);

    // drift + parallax
    this.x += this.vx + px*(this.layer==='near'? CONFIG.parallaxNear: CONFIG.parallaxFar)*DPR*0.8;
    this.y += this.vy + py*(this.layer==='near'? CONFIG.parallaxNear: CONFIG.parallaxFar)*DPR*0.8;

    if(this.x < -10 || this.x > W+10 || this.y < -10 || this.y > H+10){
      this.reset();
      // reaparece del lado contrario
      if(this.vx>0) this.x = -5; else if(this.vx<0) this.x = W+5;
      if(this.vy>0) this.y = -5; else if(this.vy<0) this.y = H+5;
    }
  }
  draw(){
    ctx.globalAlpha = this.alpha;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.r, 0, Math.PI*2);
    ctx.fillStyle = '#FFFFFF';
    ctx.fill();
  }
}

class Meteor{
  constructor(){
    this.reset();
  }
  reset(){
    const sideX = rand(-50*DPR, W*0.2);
    const sideY = rand(-50*DPR, H*0.3);
    this.x = sideX; this.y = sideY;
    this.len = rand(120, 210) * DPR;
    this.life = rand(700, 1200);
    this.t0 = performance.now();
  }
  draw(now){
    const p = clamp((now - this.t0)/this.life, 0, 1);
    const x = this.x + this.len*p;
    const y = this.y + this.len*p;
    const g = ctx.createLinearGradient(x-20,y-20, x,y);
    g.addColorStop(0,'rgba(255,255,255,0)');
    g.addColorStop(1,'rgba(255,255,255,0.9)');
    ctx.strokeStyle = g;
    ctx.lineWidth = 2*DPR;
    ctx.beginPath();
    ctx.moveTo(x-18, y-18);
    ctx.lineTo(x, y);
    ctx.stroke();
    return p>=1;
  }
}

const stars = [];
for(let i=0;i<CONFIG.starsNear;i++) stars.push(new Star('near'));
for(let i=0;i<CONFIG.starsFar;i++)  stars.push(new Star('far'));

let mouseX=0, mouseY=0;
function onMove(e){
  if(!CONFIG.parallax || prefersReduced) { mouseX=mouseY=0; return; }
  const w = innerWidth, h = innerHeight;
  const x = (e.clientX - w/2) / w;
  const y = (e.clientY - h/2) / h;
  mouseX = x; mouseY = y;
}
addEventListener('mousemove', onMove, {passive:true});

let meteors = [];
let nextMeteorAt = 0;

function loop(now){
  if(prefersReduced){
    // dibuja estático y detiene
    drawFrame(0,true);
    return;
  }
  drawFrame(now,false);
  requestAnimationFrame(loop);
}
function drawFrame(now, once){
  ctx.clearRect(0,0,W,H);

  // estrellas
  for(const s of stars){ s.step(now*0.001, mouseX, mouseY); s.draw(); }

  // meteoros
  if(CONFIG.meteors){
    if(now > nextMeteorAt){
      meteors.push(new Meteor());
      const [min,max] = CONFIG.meteorEveryMs;
      nextMeteorAt = now + rand(min,max);
    }
    meteors = meteors.filter(m => !m.draw(now));
  }

  if(once) return; // no animar más si reduce-motion
}
requestAnimationFrame(loop);

/* =================== FLOR: interacción y mensaje =================== */
const flower = document.querySelector('.flower');
const toggleBtn = document.getElementById('toggleMessage');
const message = document.getElementById('loveMessage');
const typeEl = document.getElementById('typewriter');

async function typewriter(text, el, speed){
  el.textContent = "";
  if(prefersReduced){ el.textContent = text; return; }
  for(let i=0;i<text.length;i++){
    el.textContent += text[i];
    await new Promise(r => setTimeout(r, speed));
  }
}
function toggleMessage(){
  const isHidden = message.hasAttribute('hidden');
  if(isHidden){
    message.removeAttribute('hidden');
    typewriter(CONFIG.mensaje, typeEl, CONFIG.escribirVelocidadMs);
  }else{
    message.setAttribute('hidden','');
    typeEl.textContent = '';
  }
  toggleBtn.setAttribute('aria-expanded', String(isHidden));
}
toggleBtn.addEventListener('click', toggleMessage);

let bloomTimeout=null;
function bloom(){
  flower.classList.add('bloom');
  clearTimeout(bloomTimeout);
  bloomTimeout = setTimeout(()=> flower.classList.remove('bloom'), 360);
  toggleMessage();
}
flower.addEventListener('click', bloom);
flower.addEventListener('keydown', e=>{
  if(e.key==='Enter' || e.key===' '){ e.preventDefault(); bloom(); }
});
</script>
</body>
</html>
